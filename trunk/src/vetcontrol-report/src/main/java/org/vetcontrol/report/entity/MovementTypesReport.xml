<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM 'http://java.sun.com/dtd/properties.dtd'>
<properties>
    <entry key="all">
        <![CDATA[
        SELECT
                (SELECT sc.value FROM stringculture sc WHERE sc.id =
                (SELECT cm.name FROM cargo_mode cm WHERE cm.id = cmct.cargo_mode_id)
                AND sc.locale = :locale) AS cargoModeName,
                (SELECT sc.value FROM stringculture sc where sc.id = ut.name
                AND sc.locale = :locale) AS unitTypeName,
                CAST(SUM(CASE WHEN (mt.id = 1) THEN c.count ELSE 0 END) AS UNSIGNED) AS imprt,
                CAST(SUM(CASE WHEN (mt.id = 2) THEN c.count ELSE 0 END) AS UNSIGNED) AS export,
                CAST(SUM(CASE WHEN (mt.id = 3) THEN c.count ELSE 0 END) AS UNSIGNED) AS transit,
                CAST(SUM(CASE WHEN (mt.id = 4) THEN c.count ELSE 0 END) AS UNSIGNED) AS importTransit,

                /* in current month */
                CAST(SUM(CASE WHEN (mt.id = 1 AND MONTH(dc.created) = MONTH(:endDate)) THEN c.count ELSE 0 END) AS UNSIGNED) AS imprtInCurrentMonth,
                CAST(SUM(CASE WHEN (mt.id = 2 AND MONTH(dc.created) = MONTH(:endDate)) THEN c.count ELSE 0 END) AS UNSIGNED) AS exportInCurrentMonth,
                CAST(SUM(CASE WHEN (mt.id = 3 AND MONTH(dc.created) = MONTH(:endDate)) THEN c.count ELSE 0 END) AS UNSIGNED) AS transitInCurrentMonth,
                CAST(SUM(CASE WHEN (mt.id = 4 AND MONTH(dc.created) = MONTH(:endDate)) THEN c.count ELSE 0 END) AS UNSIGNED) AS importTransitInCurrentMonth

        FROM cargo c
        LEFT JOIN cargo_mode_cargo_type cmct ON cmct.cargo_type_id = c.cargo_type_id
        LEFT JOIN unit_type ut ON c.unit_type_id = ut.id
        LEFT JOIN document_cargo dc ON dc.id = c.document_cargo_id
        LEFT JOIN movement_type mt ON mt.id = dc.movement_type_id
        WHERE dc.created>= :startDate AND dc.created <= :endDate AND dc.department_id = :department
        GROUP BY cmct.cargo_mode_id, ut.id
        ORDER BY cargoModeName
]]>
    </entry>
    <entry key="size">
        <![CDATA[
        SELECT COUNT(*) FROM (SELECT 1
                                FROM cargo c
                                LEFT JOIN cargo_mode_cargo_type cmct ON cmct.cargo_type_id = c.cargo_type_id
                                LEFT JOIN unit_type ut ON c.unit_type_id = ut.id
                                LEFT JOIN document_cargo dc ON dc.id = c.document_cargo_id
                                LEFT JOIN movement_type mt ON mt.id = dc.movement_type_id
                                WHERE dc.created>= :startDate AND dc.created <= :endDate AND dc.department_id = :department
                                GROUP BY cmct.cargo_mode_id, ut.id) report
]]>
    </entry>

</properties>
